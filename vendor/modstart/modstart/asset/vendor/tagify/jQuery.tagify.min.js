!function(s){var t,e;s.fn.tagify=function(i={}){return this.each(function(){var t,e=s(this);if(e.data("tagify"))return this;i.isJQueryPlugin=!0,t=new Tagify(e[0],i),e.data("tagify",t)})},t=this,e=function(){"use strict";function i(e,t){var i,s=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),s.push.apply(s,i)),s}const o=(t,e,i,s)=>(t=""+t,e=""+e,s&&(t=t.trim(),e=e.trim()),i?t==e:t.toLowerCase()==e.toLowerCase());function n(t,e){var i,s={};for(i in t)e.indexOf(i)<0&&(s[i]=t[i]);return s}function g(t){var e=document.createElement("div");return t.replace(/\&#?[0-9a-z]+;/gi,function(t){return e.innerHTML=t,e.innerText})}function c(t,e){for(e=e||"previous";t=t[e+"Sibling"];)if(3==t.nodeType)return t}function s(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/`|'/g,"&#039;")}function a(t){return t instanceof Array}function p(t){var e=Object.prototype.toString.call(t).split(" ")[1].slice(0,-1);return t===Object(t)&&"Array"!=e&&"Function"!=e&&"RegExp"!=e&&"HTMLUnknownElement"!=e}function u(t,e,i){function s(t,e){for(var i in e)if(e.hasOwnProperty(i)){if(p(e[i])){p(t[i])?s(t[i],e[i]):t[i]=Object.assign({},e[i]);continue}if(a(e[i])){t[i]=Object.assign([],e[i]);continue}t[i]=e[i]}}return s(t=!(t instanceof Object)?{}:t,e),i&&s(t,i),t}function m(t){return String.prototype.normalize?"string"==typeof t?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):void 0:t}var v,f=()=>/(?=.*chrome)(?=.*android)/i.test(navigator.userAgent),t={init(){this.DOM.dropdown=this.parseTemplate("dropdown",[this.settings]),this.DOM.dropdown.content=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownWrapperSelector)},show(t){var e,i=this.settings,s="mix"==i.mode&&!i.enforceWhitelist,a=!i.whitelist||!i.whitelist.length,n="manual"==i.dropdown.position;if(t=void 0===t?this.state.inputText:t,(!a||s||i.templates.dropdownItemNoMatch)&&!1!==i.dropdown.enable&&!this.state.isLoading){if(clearTimeout(this.dropdownHide__bindEventsTimeout),this.suggestedListItems=this.dropdown.filterListItems.call(this,t),t&&!this.suggestedListItems.length&&(this.trigger("dropdown:noMatch",t),i.templates.dropdownItemNoMatch&&(e=i.templates.dropdownItemNoMatch.call(this,{value:t}))),!e){if(this.suggestedListItems.length)t&&s&&!this.state.editing.scope&&!o(this.suggestedListItems[0].value,t)&&this.suggestedListItems.unshift({value:t});else{if(!t||!s||this.state.editing.scope)return this.input.autocomplete.suggest.call(this),void this.dropdown.hide.call(this);this.suggestedListItems=[{value:t}]}s=""+(p(a=this.suggestedListItems[0])?a.value:a),i.autoComplete&&s&&0==s.indexOf(t)&&this.input.autocomplete.suggest.call(this,a)}this.dropdown.fill.call(this,e),i.dropdown.highlightFirst&&this.dropdown.highlightOption.call(this,this.DOM.dropdown.content.children[0]),this.state.dropdown.visible||setTimeout(this.dropdown.events.binding.bind(this)),this.state.dropdown.visible=t||!0,this.state.dropdown.query=t,this.setStateSelection(),n||setTimeout(()=>{this.dropdown.position.call(this),this.dropdown.render.call(this)}),setTimeout(()=>{this.trigger("dropdown:show",this.DOM.dropdown)})}},hide(t){var e=this.DOM,i=e.scope,e=e.dropdown,t="manual"==this.settings.dropdown.position&&!t;if(e&&document.body.contains(e)&&!t)return window.removeEventListener("resize",this.dropdown.position),this.dropdown.events.binding.call(this,!1),i.setAttribute("aria-expanded",!1),e.parentNode.removeChild(e),setTimeout(()=>{this.state.dropdown.visible=!1},100),this.state.dropdown.query=this.state.ddItemData=this.state.ddItemElm=this.state.selection=null,this.state.tag&&this.state.tag.value.length&&(this.state.flaggedTags[this.state.tag.baseOffset]=this.state.tag),this.trigger("dropdown:hide",e),this},render(){var t,e=((t=this.DOM.dropdown.cloneNode(!0)).style.cssText="position:fixed; top:-9999px; opacity:0",document.body.appendChild(t),e=t.clientHeight,t.parentNode.removeChild(t),e),i=this.settings;return this.DOM.scope.setAttribute("aria-expanded",!0),document.body.contains(this.DOM.dropdown)||(this.DOM.dropdown.classList.add(i.classNames.dropdownInital),this.dropdown.position.call(this,e),i.dropdown.appendTarget.appendChild(this.DOM.dropdown),setTimeout(()=>this.DOM.dropdown.classList.remove(i.classNames.dropdownInital))),this},fill(t){t="string"==typeof t?t:this.dropdown.createListHTML.call(this,t||this.suggestedListItems),this.DOM.dropdown.content.innerHTML=t?t.replace(/\>[\r\n ]+\</g,"><").replace(/(<.*?>)|\s+/g,(t,e)=>e||" "):""},refilter(t){t=t||this.state.dropdown.query||"",this.suggestedListItems=this.dropdown.filterListItems.call(this,t),this.dropdown.fill.call(this),this.suggestedListItems.length||this.dropdown.hide.call(this),this.trigger("dropdown:updated",this.DOM.dropdown)},position(t){var e,i,s,a,n,o,r,l,d,h=this.settings.dropdown;"manual"!=h.position&&(o=this.DOM.dropdown,r=h.placeAbove,l=document.documentElement.clientHeight,d=480<Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)?h.position:"all",h=this.DOM["input"==d?"input":"scope"],t=t||o.clientHeight,this.state.dropdown.visible&&(n="text"==d?(s=(e=this.getCaretGlobalPosition()).bottom,i=e.top,a=e.left,"auto"):(n=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft||0,i+=t.offsetTop||0,t=t.parentNode;return{left:e,top:i}}(this.settings.dropdown.appendTarget),i=(e=h.getBoundingClientRect()).top-n.top,s=e.bottom-1-n.top,a=e.left-n.left,e.width+"px"),i=Math.floor(i),s=Math.ceil(s),r=void 0===r?l-e.bottom<t:r,o.style.cssText="left:"+(a+window.pageXOffset)+"px; width:"+n+";"+(r?"top: "+(i+window.pageYOffset)+"px":"top: "+(s+window.pageYOffset)+"px"),o.setAttribute("placement",r?"top":"bottom"),o.setAttribute("position",d)))},events:{binding(t=!0){var e=this.dropdown.events.callbacks,e=this.listeners.dropdown=this.listeners.dropdown||{position:this.dropdown.position.bind(this),onKeyDown:e.onKeyDown.bind(this),onMouseOver:e.onMouseOver.bind(this),onMouseLeave:e.onMouseLeave.bind(this),onClick:e.onClick.bind(this),onScroll:e.onScroll.bind(this)},t=t?"addEventListener":"removeEventListener";"manual"!=this.settings.dropdown.position&&(window[t]("resize",e.position),window[t]("keydown",e.onKeyDown)),this.DOM.dropdown[t]("mouseover",e.onMouseOver),this.DOM.dropdown[t]("mouseleave",e.onMouseLeave),this.DOM.dropdown[t]("mousedown",e.onClick),this.DOM.dropdown.content[t]("scroll",e.onScroll)},callbacks:{onKeyDown(t){var e=this.DOM.dropdown.querySelector(this.settings.classNames.dropdownItemActiveSelector),i=this.dropdown.getSuggestionDataByNode.call(this,e);switch(t.key){case"ArrowDown":case"ArrowUp":case"Down":case"Up":t.preventDefault(),(e=e&&e[("ArrowUp"==t.key||"Up"==t.key?"previous":"next")+"ElementSibling"])||(s=this.DOM.dropdown.content.children,e=s["ArrowUp"==t.key||"Up"==t.key?s.length-1:0]),i=this.dropdown.getSuggestionDataByNode.call(this,e),this.dropdown.highlightOption.call(this,e,!0);break;case"Escape":case"Esc":this.dropdown.hide.call(this);break;case"ArrowRight":if(this.state.actions.ArrowLeft)return;case"Tab":if("mix"==this.settings.mode||!e||this.settings.autoComplete.rightKey||this.state.editing)return!0;t.preventDefault();var s=this.dropdown.getMappedValue.call(this,i);return this.input.autocomplete.set.call(this,s),!1;case"Enter":t.preventDefault(),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then(()=>{e?this.dropdown.selectOption.call(this,e):this.dropdown.hide.call(this)}).catch(t=>t);break;case"Backspace":{if("mix"==this.settings.mode||this.state.editing.scope)return;let t=this.state.inputText.trim();""!=t&&8203!=t.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():"edit"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0))}}},onMouseOver(t){t=t.target.closest(this.settings.classNames.dropdownItemSelector);t&&this.dropdown.highlightOption.call(this,t)},onMouseLeave(t){this.dropdown.highlightOption.call(this)},onClick(t){var e,i;0==t.button&&t.target!=this.DOM.dropdown&&t.target!=this.DOM.dropdown.content&&(e=t.target.closest(this.settings.classNames.dropdownItemSelector),i=this.dropdown.getSuggestionDataByNode.call(this,e),this.state.actions.selectOption=!0,setTimeout(()=>this.state.actions.selectOption=!1,50),this.settings.hooks.suggestionClick(t,{tagify:this,tagData:i,suggestionElm:e}).then(()=>{e?this.dropdown.selectOption.call(this,e):this.dropdown.hide.call(this)}).catch(t=>t))},onScroll(t){t=t.target,t=t.scrollTop/(t.scrollHeight-t.parentNode.clientHeight)*100;this.trigger("dropdown:scroll",{percentage:Math.round(t)})}}},getSuggestionDataByNode(t){t=t?+t.getAttribute("tagifySuggestionIdx"):-1;return this.suggestedListItems[t]||null},highlightOption(t,e){var i,s=this.settings.classNames.dropdownItemActive;if(this.state.ddItemElm&&(this.state.ddItemElm.classList.remove(s),this.state.ddItemElm.removeAttribute("aria-selected")),!t)return this.state.ddItemData=null,this.state.ddItemElm=null,void this.input.autocomplete.suggest.call(this);i=this.suggestedListItems[this.getNodeIndex(t)],this.state.ddItemData=i,(this.state.ddItemElm=t).classList.add(s),t.setAttribute("aria-selected",!0),e&&(t.parentNode.scrollTop=t.clientHeight+t.offsetTop-t.parentNode.clientHeight),this.settings.autoComplete&&(this.input.autocomplete.suggest.call(this,i),this.dropdown.position.call(this))},selectOption(t){var e=this.settings.dropdown,i=e.clearOnSelect,s=e.closeOnSelect;if(!t)return this.addTags(this.state.inputText,!0),void(s&&this.dropdown.hide.call(this));var a=t.getAttribute("tagifySuggestionIdx"),e=this.suggestedListItems[+a];this.trigger("dropdown:select",{data:e,elm:t}),a&&e?(this.state.editing?this.onEditTagDone(null,u({__isValid:!0},e)):this["mix"==this.settings.mode?"addMixTags":"addTags"]([e],i),setTimeout(()=>{this.DOM.input.focus(),this.toggleFocusClass(!0)}),s?setTimeout(this.dropdown.hide.bind(this)):this.dropdown.refilter.call(this)):this.dropdown.hide.call(this)},selectAll(){return this.suggestedListItems.length=0,this.dropdown.hide.call(this),this.addTags(this.dropdown.filterListItems.call(this,""),!0),this},filterListItems(t,e){var i,s,a,n,o=this.settings,r=o.dropdown,l=(e=e||{},t="select"==o.mode&&this.value.length&&this.value[0][o.tagTextProp]==t?"":t,[]),d=o.whitelist,h=r.maxItems||1/0,g=r.searchKeys,c=0;if(!t||!g.length)return(o.duplicates?d:d.filter(t=>!this.isTagDuplicate(p(t)?t.value:t))).slice(0,h);for(n=r.caseSensitive?""+t:(""+t).toLowerCase();c<d.length;c++){i=d[c]instanceof Object?d[c]:{value:d[c]};let t=Object.keys(i).some(t=>g.includes(t))?g:["value"];if(s=r.fuzzySearch&&!e.exact?(a=t.reduce((t,e)=>t+" "+(i[e]||""),"").toLowerCase(),r.accentedSearch&&(a=m(a),n=m(n)),function(e,t){return t.toLowerCase().split(" ").every(t=>e.includes(t.toLowerCase()))}(a,n)):t.some(t=>{t=""+(i[t]||"");return r.accentedSearch&&(t=m(t),n=m(n)),r.caseSensitive||(t=t.toLowerCase()),e.exact?t==n:0==t.indexOf(n)}),a=!o.duplicates&&this.isTagDuplicate(p(i)?i.value:i),s&&!a&&h--&&l.push(i),0==h)break}return l},getMappedValue(t){var e=this.settings.dropdown.mapValueTo;return e?"function"==typeof e?e(t):t[e]||t.value:t.value},createListHTML(t){return u([],t).map((t,e)=>{var i=this.dropdown.getMappedValue.call(this,t="string"==typeof t||"number"==typeof t?{value:t}:t);t.value=i&&"string"==typeof i?s(i):i;t=this.settings.templates.dropdownItem.call(this,t);return t.replace(/\s*tagifySuggestionIdx=(["'])(.*?)\1/gim,"").replace(">",` tagifySuggestionIdx="${e}">`)}).join("")}},e={delimiters:",",pattern:null,tagTextProp:"value",maxTags:1/0,callbacks:{},addTagOnBlur:!0,duplicates:!1,whitelist:[],blacklist:[],enforceWhitelist:!1,keepInvalidTags:!1,mixTagsAllowedAfter:/,|\.|\:|\s/,mixTagsInterpolator:["[[","]]"],backspace:!0,skipInvalid:!1,editTags:{clicks:2,keepInvalid:!0},transformTag:()=>{},trim:!0,a11y:{focusableTags:!1},mixMode:{insertAfterTag:" "},autoComplete:{enabled:!0,rightKey:!1},classNames:{namespace:"tagify",mixMode:"tagify--mix",selectMode:"tagify--select",input:"tagify__input",focus:"tagify--focus",tag:"tagify__tag",tagNoAnimation:"tagify--noAnim",tagInvalid:"tagify--invalid",tagNotAllowed:"tagify--notAllowed",inputInvalid:"tagify__input--invalid",tagX:"tagify__tag__removeBtn",tagText:"tagify__tag-text",dropdown:"tagify__dropdown",dropdownWrapper:"tagify__dropdown__wrapper",dropdownItem:"tagify__dropdown__item",dropdownItemActive:"tagify__dropdown__item--active",dropdownInital:"tagify__dropdown--initial",scopeLoading:"tagify--loading",tagLoading:"tagify__tag--loading",tagEditing:"tagify__tag--editable",tagFlash:"tagify__tag--flash",tagHide:"tagify__tag--hide",hasMaxTags:"tagify--hasMaxTags",hasNoTags:"tagify--noTags",empty:"tagify--empty"},dropdown:{classname:"",enabled:2,maxItems:10,searchKeys:["value","searchBy"],fuzzySearch:!0,caseSensitive:!1,accentedSearch:!0,highlightFirst:!1,closeOnSelect:!0,clearOnSelect:!0,position:"all",appendTarget:null},hooks:{beforeRemoveTag:()=>Promise.resolve(),beforePaste:()=>Promise.resolve(),suggestionClick:()=>Promise.resolve()}},r={customBinding(){this.customEventsList.forEach(t=>{this.on(t,this.settings.callbacks[t])})},binding(t=!0){var e,i=this.events.callbacks,s=t?"addEventListener":"removeEventListener";if(!this.state.mainEvents||!t)for(var a in(this.state.mainEvents=t)&&!this.listeners.main&&(this.DOM.input.addEventListener(this.isIE?"keydown":"input",i[this.isIE?"onInputIE":"onInput"].bind(this)),window.addEventListener("keydown",i.onWindowKeyDown.bind(this)),this.settings.isJQueryPlugin&&jQuery(this.DOM.originalInput).on("tagify.removeAllTags",this.removeAllTags.bind(this))),e=this.listeners.main=this.listeners.main||{focus:["input",i.onFocusBlur.bind(this)],blur:["input",i.onFocusBlur.bind(this)],keydown:["input",i.onKeydown.bind(this)],click:["scope",i.onClickScope.bind(this)],dblclick:["scope",i.onDoubleClickScope.bind(this)],paste:["input",i.onPaste.bind(this)]})"blur"==a&&!t||this.DOM[e[a][0]][s](a,e[a][1])},callbacks:{onFocusBlur(t){var e=t.target?this.trim(t.target.textContent):"",i=this.settings,s=t.type,a=0<=i.dropdown.enabled,n={relatedTarget:t.relatedTarget},o=this.state.actions.selectOption&&(a||!i.dropdown.closeOnSelect),r=this.state.actions.addNew&&a,a=t.relatedTarget&&t.relatedTarget.classList.contains(i.classNames.tag)&&this.DOM.scope.contains(t.relatedTarget);if("blur"==s){if(t.relatedTarget===this.DOM.scope)return this.dropdown.hide.call(this),void this.DOM.input.focus();this.postUpdate(),this.triggerChangeEvent()}if(!o&&!r)if(this.state.hasFocus="focus"==s&&+new Date,this.toggleFocusClass(this.state.hasFocus),"mix"!=i.mode){if("focus"==s)return this.trigger("focus",n),void(0===i.dropdown.enabled&&this.dropdown.show.call(this));"blur"==s&&(this.trigger("blur",n),this.loading(!1),"select"==this.settings.mode&&a&&(e=""),("select"==this.settings.mode&&e?!this.value.length||this.value[0].value!=e:e&&!this.state.actions.selectOption&&i.addTagOnBlur)&&this.addTags(e,!0),"select"!=this.settings.mode||e||this.removeTags()),this.DOM.input.removeAttribute("style"),this.dropdown.hide.call(this)}else"focus"==s?this.trigger("focus",n):"blur"==t.type&&(this.trigger("blur",n),this.loading(!1),this.dropdown.hide.call(this),this.state.dropdown.visible=void 0,this.setStateSelection())},onWindowKeyDown(t){var e,i=document.activeElement;if(i.classList.contains(this.settings.classNames.tag)&&this.DOM.scope.contains(document.activeElement))switch(e=i.nextElementSibling,t.key){case"Backspace":this.removeTags(i),(e||this.DOM.input).focus();break;case"Enter":setTimeout(this.editTag.bind(this),0,i)}},onKeydown(t){var e=this.trim(t.target.textContent);if(this.trigger("keydown",{originalEvent:this.cloneEvent(t)}),"mix"==this.settings.mode){switch(t.key){case"Left":case"ArrowLeft":this.state.actions.ArrowLeft=!0;break;case"Delete":case"Backspace":if(this.state.editing)return;var i,s,a,n=document.getSelection(),o="Delete"==t.key&&n.anchorOffset==(n.anchorNode.length||0),r=1==n.anchorNode.nodeType||!n.anchorOffset&&n.anchorNode.previousElementSibling,l=g(this.DOM.input.innerHTML),d=this.getTagElms();if("edit"==this.settings.backspace&&r)return i=1==n.anchorNode.nodeType?null:n.anchorNode.previousElementSibling,setTimeout(this.editTag.bind(this),0,i),void t.preventDefault();if(f()&&r)return a=c(r),r.hasAttribute("readonly")||r.remove(),this.DOM.input.focus(),void setTimeout(()=>{this.placeCaretAfterNode(a),this.DOM.input.click()});if("BR"==n.anchorNode.nodeName)return;if((o||r)&&1==n.anchorNode.nodeType?s=0==n.anchorOffset?o?d[0]:null:d[n.anchorOffset-1]:o?s=n.anchorNode.nextElementSibling:r&&(s=r),3==n.anchorNode.nodeType&&!n.anchorNode.nodeValue&&n.anchorNode.previousElementSibling&&t.preventDefault(),(r||o)&&!this.settings.backspace)return void t.preventDefault();if("Range"!=n.type&&!n.anchorOffset&&n.anchorNode==this.DOM.input&&"Delete"!=t.key)return void t.preventDefault();if("Range"!=n.type&&s&&s.hasAttribute("readonly"))return void this.placeCaretAfterNode(c(s));clearTimeout(v),v=setTimeout(()=>{var t=document.getSelection(),e=g(this.DOM.input.innerHTML),t=t.anchorNode.previousElementSibling;if(!f()&&e.length>=l.length&&t&&!t.hasAttribute("readonly")&&(this.removeTags(t),this.fixFirefoxLastTagNoCaret(),2==this.DOM.input.children.length&&"BR"==this.DOM.input.children[1].tagName))return this.DOM.input.innerHTML="",!(this.value.length=0);this.value=[].map.call(d,(t,e)=>{var i=this.tagData(t);if(t.parentNode||i.readonly)return i;this.trigger("remove",{tag:t,index:e,data:i})}).filter(t=>t)},20)}return!0}switch(t.key){case"Backspace":this.state.dropdown.visible&&"manual"!=this.settings.dropdown.position||""!=e&&8203!=e.charCodeAt(0)||(!0===this.settings.backspace?this.removeTags():"edit"==this.settings.backspace&&setTimeout(this.editTag.bind(this),0));break;case"Esc":case"Escape":if(this.state.dropdown.visible)return;t.target.blur();break;case"Down":case"ArrowDown":this.state.dropdown.visible||this.dropdown.show.call(this);break;case"ArrowRight":var h=this.state.inputSuggestion||this.state.ddItemData;if(h&&this.settings.autoComplete.rightKey)return void this.addTags([h],!0);break;case"Tab":h="select"==this.settings.mode;if(!e||h)return!0;t.preventDefault();case"Enter":if(this.state.dropdown.visible||229==t.keyCode)return;t.preventDefault(),setTimeout(()=>{this.state.actions.selectOption||this.addTags(e,!0)})}},onInput(t){if("mix"==this.settings.mode)return this.events.callbacks.onMixTagsInput.call(this,t);var e=this.input.normalize.call(this),i=e.length>=this.settings.dropdown.enabled,t={value:e,inputElm:this.DOM.input};t.isValid=this.validateTag({value:e}),this.trigger("input",t),this.state.inputText!=e&&(this.input.set.call(this,e,!1),-1!=e.search(this.settings.delimiters)?this.addTags(e)&&this.input.set.call(this):0<=this.settings.dropdown.enabled&&this.dropdown[i?"show":"hide"].call(this,e))},onMixTagsInput(t){var e,i,s,a,n=this.settings,o=this.value.length,r=this.getTagElms(),l=document.createDocumentFragment(),d=window.getSelection().getRangeAt(0),h=[].map.call(r,t=>this.tagData(t).value);if("deleteContentBackward"==t.inputType&&f()&&this.events.callbacks.onKeydown.call(this,{target:t.target,key:"Backspace"}),this.value.slice().forEach(t=>{t.readonly&&!h.includes(t.value)&&l.appendChild(this.createTagElem(t))}),l.childNodes.length&&(d.insertNode(l),this.setRangeAtStartEnd(!1,l.lastChild)),r.length!=o)return this.value=[].map.call(this.getTagElms(),t=>this.tagData(t)),void this.update({withoutChangeEvent:!0});if(this.hasMaxTags())return!0;if(window.getSelection&&0<(a=window.getSelection()).rangeCount&&3==a.anchorNode.nodeType){if((d=a.getRangeAt(0).cloneRange()).collapse(!0),d.setStart(a.focusNode,0),o=(r=d.toString().slice(0,d.endOffset)).split(n.pattern).length-1,e=(d=r.match(n.pattern))?r.slice(r.lastIndexOf(d[d.length-1])):e){if(this.state.actions.ArrowLeft=!1,this.state.tag={prefix:e.match(n.pattern)[0],value:e.replace(n.pattern,"")},this.state.tag.baseOffset=a.baseOffset-this.state.tag.value.length,a=this.state.tag.value.match(n.delimiters))return this.state.tag.value=this.state.tag.value.replace(n.delimiters,""),this.state.tag.delimiters=a[0],this.addTags(this.state.tag.value,n.dropdown.clearOnSelect),void this.dropdown.hide.call(this);i=this.state.tag.value.length>=n.dropdown.enabled;try{s=(s=this.state.flaggedTags[this.state.tag.baseOffset]).prefix==this.state.tag.prefix&&s.value[0]==this.state.tag.value[0],this.state.flaggedTags[this.state.tag.baseOffset]&&!this.state.tag.value&&delete this.state.flaggedTags[this.state.tag.baseOffset]}catch(t){}(s||o<this.state.mixMode.matchedPatternCount)&&(i=!1)}else this.state.flaggedTags={};this.state.mixMode.matchedPatternCount=o}setTimeout(()=>{this.update({withoutChangeEvent:!0}),this.trigger("input",u({},this.state.tag,{textContent:this.DOM.input.textContent})),this.state.tag&&this.dropdown[i?"show":"hide"].call(this,this.state.tag.value)},10)},onInputIE(t){var e=this;setTimeout(function(){e.events.callbacks.onInput.call(e,t)})},onClickScope(t){var e=this.settings,i=t.target.closest("."+e.classNames.tag),s=+new Date-this.state.hasFocus;if(t.target!=this.DOM.scope){if(!t.target.classList.contains(e.classNames.tagX))return i?(this.trigger("click",{tag:i,index:this.getNodeIndex(i),data:this.tagData(i),originalEvent:this.cloneEvent(t)}),void(1!==e.editTags&&1!==e.editTags.clicks||this.events.callbacks.onDoubleClickScope.call(this,t))):void(t.target==this.DOM.input&&("mix"==e.mode&&this.fixFirefoxLastTagNoCaret(),500<s)?this.state.dropdown.visible?this.dropdown.hide.call(this):0===e.dropdown.enabled&&"mix"!=e.mode&&this.dropdown.show.call(this):"select"!=e.mode||this.state.dropdown.visible||this.dropdown.show.call(this));this.removeTags(t.target.parentNode)}else this.state.hasFocus||this.DOM.input.focus()},onPaste(e){var t,i;e.preventDefault(),this.settings.readonly||(t=e.clipboardData||window.clipboardData,i=t.getData("Text"),this.settings.hooks.beforePaste(e,{tagify:this,pastedText:i,clipboardData:t}).then(t=>{(t=void 0===t?i:t)&&(this.injectAtCaret(t,window.getSelection().getRangeAt(0)),"mix"==this.settings.mode?this.events.callbacks.onMixTagsInput.call(this,e):this.addTags(this.DOM.input.textContent,!0))}).catch(t=>t))},onEditTagInput(t,e){var i=t.closest("."+this.settings.classNames.tag),s=this.getNodeIndex(i),a=this.tagData(i),n=this.input.normalize.call(this,t),o=i.innerHTML!=i.__tagifyTagData.__originalHTML,r=this.validateTag({[this.settings.tagTextProp]:n});o||!0!==t.originalIsValid||(r=!0),i.classList.toggle(this.settings.classNames.tagInvalid,!0!==r),a.__isValid=r,i.title=!0===r?a.title||a.value:r,n.length>=this.settings.dropdown.enabled&&(this.state.editing&&(this.state.editing.value=n),this.dropdown.show.call(this,n)),this.trigger("edit:input",{tag:i,index:s,data:u({},this.value[s],{newValue:n}),originalEvent:this.cloneEvent(e)})},onEditTagFocus(t){this.state.editing={scope:t,input:t.querySelector("[contenteditable]")}},onEditTagBlur(t){if(this.state.hasFocus||this.toggleFocusClass(),this.DOM.scope.contains(t)){var e=this.settings,i=t.closest("."+e.classNames.tag),s=this.input.normalize.call(this,t),a=this.tagData(i).__originalData,n=i.innerHTML!=i.__tagifyTagData.__originalHTML,t=this.validateTag({[e.tagTextProp]:s});if(s)if(n){if(s=this.getWhitelistItem(s)||u({},a,{[e.tagTextProp]:s,value:s}),e.transformTag.call(this,s,a),!0!==(t=this.validateTag({[e.tagTextProp]:s[e.tagTextProp]}))){if(this.trigger("invalid",{data:s,tag:i,message:t}),e.editTags.keepInvalid)return;e.keepInvalidTags?s.__isValid=t:s=a}this.onEditTagDone(i,s)}else this.onEditTagDone(i,a);else this.onEditTagDone(i)}},onEditTagkeydown(t,e){switch(this.trigger("edit:keydown",{originalEvent:this.cloneEvent(t)}),t.key){case"Esc":case"Escape":e.innerHTML=e.__tagifyTagData.__originalHTML;case"Enter":case"Tab":t.preventDefault(),t.target.blur()}},onDoubleClickScope(t){var e,i=t.target.closest("."+this.settings.classNames.tag),s=this.settings;i&&(e=i.classList.contains(this.settings.classNames.tagEditing),t=i.hasAttribute("readonly"),"select"==s.mode||s.readonly||e||t||!this.settings.editTags||this.editTag(i),this.toggleFocusClass(!0),this.trigger("dblclick",{tag:i,index:this.getNodeIndex(i),data:this.tagData(i)}))}}};function l(t,e){return t?t.previousElementSibling&&t.previousElementSibling.classList.contains("tagify")?(console.warn("Tagify: ","input element is already Tagified",t),this):(u(this,(o=this,r=document.createTextNode(""),{off(t,e){return i("remove",t,e),this},on(t,e){return e&&"function"==typeof e&&i("add",t,e),this},trigger(t,e,i){var s;if(i=i||{cloneData:!0},t)if(o.settings.isJQueryPlugin)"remove"==t&&(t="removeTag"),jQuery(o.DOM.originalInput).triggerHandler(t,[e]);else{try{var a="object"==typeof e?e:{value:e};if((a=i.cloneData?u({},a):a).tagify=this,e instanceof Object)for(var n in e)e[n]instanceof HTMLElement&&(a[n]=e[n]);s=new CustomEvent(t,{detail:a})}catch(t){console.warn(t)}r.dispatchEvent(s)}}})),this.isFirefox="undefined"!=typeof InstallTrigger,this.isIE=window.document.documentMode,this.applySettings(t,e||{}),this.state={inputText:"",editing:!1,actions:{},mixMode:{},dropdown:{},flaggedTags:{}},this.value=[],this.listeners={},this.DOM={},this.build(t),this.getCSSVars(),this.loadOriginalValues(),this.events.customBinding.call(this),this.events.binding.call(this),void(t.autofocus&&this.DOM.input.focus())):(console.warn("Tagify: ","input element not found",t),this);function i(e,t,i){i&&t.split(/\s+/g).forEach(t=>r[e+"EventListener"].call(r,t,i))}var o,r}return(l.prototype={dropdown:t,TEXTS:{empty:"empty",exceed:"number of tags exceeded",pattern:"pattern mismatch",duplicate:"already exists",notAllowed:"not allowed"},customEventsList:["change","add","remove","invalid","input","click","keydown","focus","blur","edit:input","edit:beforeUpdate","edit:updated","edit:start","edit:keydown","dropdown:show","dropdown:hide","dropdown:select","dropdown:updated","dropdown:noMatch"],dataProps:["__isValid","__removed","__originalData","__originalHTML","__tagId"],trim(t){return this.settings.trim&&t&&"string"==typeof t?t.trim():t},parseHTML:function(t){return(new DOMParser).parseFromString(t.trim(),"text/html").body.firstElementChild},templates:{wrapper:(t,e)=>`<tags class="${e.classNames.namespace} ${e.mode?`${e.classNames[e.mode+"Mode"]}`:""} ${t.className}"\n                    ${e.readonly?"readonly":""}\n                    ${e.required?"required":""}\n                    tabIndex="-1">\n            <span ${e.readonly&&"mix"==e.mode?"":"contenteditable"} data-placeholder="${e.placeholder||"&#8203;"}" aria-placeholder="${e.placeholder||""}"\n                class="${e.classNames.input}"\n                role="textbox"\n                aria-autocomplete="both"\n                aria-multiline="${"mix"==e.mode}"></span>\n        </tags>`,tag(t){return`<tag title="${t.title||t.value}"\n                    contenteditable='false'\n                    spellcheck='false'\n                    tabIndex="${this.settings.a11y.focusableTags?0:-1}"\n                    class="${this.settings.classNames.tag} ${t.class||""}"\n                    ${this.getAttributes(t)}>\n            <x title='' class="${this.settings.classNames.tagX}" role='button' aria-label='remove tag'></x>\n            <div>\n                <span class="${this.settings.classNames.tagText}">${t[this.settings.tagTextProp]||t.value}</span>\n            </div>\n        </tag>`},dropdown(t){var e=t.dropdown,i="manual"==e.position,s=`${t.classNames.dropdown}`;return`<div class="${i?"":s} ${e.classname}" role="listbox" aria-labelledby="dropdown">\n                    <div class="${t.classNames.dropdownWrapper}"></div>\n                </div>`},dropdownItem(t){return`<div ${this.getAttributes(t)}\n                    class='${this.settings.classNames.dropdownItem} ${t.class||""}'\n                    tabindex="0"\n                    role="option">${t.value}</div>`},dropdownItemNoMatch:null},parseTemplate(t,e){return t=this.settings.templates[t]||t,this.parseHTML(t.apply(this,e))},applySettings(i,t){e.templates=this.templates;var s=this.settings=u({},e,t);s.readonly=i.hasAttribute("readonly"),s.placeholder=i.getAttribute("placeholder")||s.placeholder||"",s.required=i.hasAttribute("required");for(let t in s.classNames)Object.defineProperty(s.classNames,t+"Selector",{get(){return"."+this[t].split(" ").join(".")}});if(this.isIE&&(s.autoComplete=!1),["whitelist","blacklist"].forEach(t=>{var e=i.getAttribute("data-"+t);e&&(e=e.split(s.delimiters))instanceof Array&&(s[t]=e)}),"autoComplete"in t&&!p(t.autoComplete)&&(s.autoComplete=e.autoComplete,s.autoComplete.enabled=t.autoComplete),"mix"==s.mode&&(s.autoComplete.rightKey=!0,s.delimiters=t.delimiters||null,s.tagTextProp&&!s.dropdown.searchKeys.includes(s.tagTextProp)&&s.dropdown.searchKeys.push(s.tagTextProp)),i.pattern)try{s.pattern=new RegExp(i.pattern)}catch(i){}if(this.settings.delimiters)try{s.delimiters=new RegExp(this.settings.delimiters,"g")}catch(i){}"select"==s.mode&&(s.dropdown.enabled=0),s.dropdown.appendTarget=t.dropdown&&t.dropdown.appendTarget?t.dropdown.appendTarget:document.body},getAttributes(t){if("[object Object]"!=Object.prototype.toString.call(t))return"";for(var e,i=Object.keys(t),s="",a=i.length;a--;)"__"!=(e=i[a]).slice(0,2)&&"class"!=e&&t.hasOwnProperty(e)&&void 0!==t[e]&&(s+=" "+e+(void 0!==t[e]?`="${t[e]}"`:""));return s},setStateSelection(){var t=window.getSelection(),t={anchorOffset:t.anchorOffset,anchorNode:t.anchorNode,range:t.getRangeAt&&t.rangeCount&&t.getRangeAt(0)};return this.state.selection=t},getCaretGlobalPosition(){const i=document.getSelection();if(i.rangeCount){const s=i.getRangeAt(0),a=s.startContainer,n=s.startOffset;let t,e;if(0<n)return e=document.createRange(),e.setStart(a,n-1),e.setEnd(a,n),{left:(t=e.getBoundingClientRect()).right,top:t.top,bottom:t.bottom};if(a.getBoundingClientRect)return a.getBoundingClientRect()}return{left:-9999,top:-9999}},getCSSVars(){var t,e=getComputedStyle(this.DOM.scope,null);this.CSSVars={tagHideTransition:([{value:t,unit:e}]=[function(t){if(!t)return{};var e=(t=t.trim().split(" ")[0]).split(/\d+/g).filter(t=>t).pop().trim();return{value:+t.split(e).filter(t=>t)[0].trim(),unit:e}}(e.getPropertyValue("--tag-hide-transition"))],"s"==e?1e3*t:t)}},build(t){var e=this.DOM;this.settings.mixMode.integrated?(e.originalInput=null,e.scope=t,e.input=t):(e.originalInput=t,e.scope=this.parseTemplate("wrapper",[t,this.settings]),e.input=e.scope.querySelector(this.settings.classNames.inputSelector),t.parentNode.insertBefore(e.scope,t)),0<=this.settings.dropdown.enabled&&this.dropdown.init.call(this)},destroy(){this.DOM.scope.parentNode.removeChild(this.DOM.scope),this.dropdown.hide.call(this,!0),clearTimeout(this.dropdownHide__bindEventsTimeout)},loadOriginalValues(t){var e,i=this.settings;if(void 0===t&&(t=i.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value),this.removeAllTags({withoutChangeEvent:!0}),t)if("mix"==i.mode)this.parseMixTags(t.trim()),(e=this.DOM.input.lastChild)&&"BR"==e.tagName||this.DOM.input.insertAdjacentHTML("beforeend","<br>");else{try{JSON.parse(t)instanceof Array&&(t=JSON.parse(t))}catch(t){}this.addTags(t).forEach(t=>t&&t.classList.add(i.classNames.tagNoAnimation))}else this.postUpdate();this.state.lastOriginalValueReported=i.mixMode.integrated?"":this.DOM.originalInput.value,this.state.loadedOriginalValues=!0},cloneEvent(t){var e,i={};for(e in t)i[e]=t[e];return i},loading(t){return this.state.isLoading=t,this.DOM.scope.classList[t?"add":"remove"](this.settings.classNames.scopeLoading),this},tagLoading(t,e){return t&&t.classList[e?"add":"remove"](this.settings.classNames.tagLoading),this},toggleClass(t,e){"string"==typeof t&&this.DOM.scope.classList.toggle(t,e)},toggleFocusClass(t){this.toggleClass(this.settings.classNames.focus,!!t)},triggerChangeEvent:function(){var t,e,i;this.settings.mixMode.integrated||(t=this.DOM.originalInput,e=this.state.lastOriginalValueReported!==t.value,i=new CustomEvent("change",{bubbles:!0}),e&&(this.state.lastOriginalValueReported=t.value,i.simulated=!0,t._valueTracker&&t._valueTracker.setValue(Math.random()),t.dispatchEvent(i),this.trigger("change",this.state.lastOriginalValueReported),t.value=this.state.lastOriginalValueReported))},events:r,fixFirefoxLastTagNoCaret(){},placeCaretAfterNode(t){var e,i,s;t&&t.parentNode&&(e=t.nextSibling,s=(i=window.getSelection()).getRangeAt(0),i.rangeCount&&(s.setStartBefore(e||t),s.setEndBefore(e||t),i.removeAllRanges(),i.addRange(s)))},insertAfterTag(t,e){if(e=e||this.settings.mixMode.insertAfterTag,t&&t.parentNode&&e)return e="string"==typeof e?document.createTextNode(e):e,t.parentNode.insertBefore(e,t.nextSibling),e},editTag(e,t){e=e||this.getLastTag(),t=t||{},this.dropdown.hide.call(this);var i=this.settings;function s(){return e.querySelector(i.classNames.tagTextSelector)}var a=s(),n=this.getNodeIndex(e),o=this.tagData(e),r=this.events.callbacks,l=this,d=!0;if(a){if(!(o instanceof Object&&"editable"in o)||o.editable)return a.setAttribute("contenteditable",!0),e.classList.add(i.classNames.tagEditing),this.tagData(e,{__originalData:u({},o),__originalHTML:e.innerHTML}),a.addEventListener("focus",r.onEditTagFocus.bind(this,e)),a.addEventListener("blur",function(){setTimeout(()=>r.onEditTagBlur.call(l,s()))}),a.addEventListener("input",r.onEditTagInput.bind(this,a)),a.addEventListener("keydown",t=>r.onEditTagkeydown.call(this,t,e)),a.focus(),this.setRangeAtStartEnd(!1,a),t.skipValidation||(d=this.editTagToggleValidity(e,o.value)),a.originalIsValid=d,this.trigger("edit:start",{tag:e,index:n,data:o,isValid:d}),this}else console.warn("Cannot find element in Tag template: .",i.classNames.tagTextSelector)},editTagToggleValidity(t,e){var i,s=this.tagData(t);if(s)return i=!(!s.__isValid||1==s.__isValid),t.classList.toggle(this.settings.classNames.tagInvalid,i),s.__isValid;console.warn("tag has no data: ",t,s)},onEditTagDone(t,e){e=e||{};var i={tag:t=t||this.state.editing.scope,index:this.getNodeIndex(t),previousData:this.tagData(t),data:e};this.trigger("edit:beforeUpdate",i,{cloneData:!1}),this.state.editing=!1,delete e.__originalData,delete e.__originalHTML,t&&e[this.settings.tagTextProp]?(this.editTagToggleValidity(t),t=this.replaceTag(t,e),this.settings.a11y.focusableTags&&t.focus()):t&&this.removeTags(t),this.trigger("edit:updated",i),this.dropdown.hide.call(this),this.settings.keepInvalidTags&&this.reCheckInvalidTags()},replaceTag(t,e){(e=!e||!e.value?t.__tagifyTagData:e).__isValid&&1!=e.__isValid&&u(e,this.getInvalidTagAttrs(e,e.__isValid));e=this.createTagElem(e);return t.parentNode.replaceChild(e,t),this.updateValueByDOMTags(),e},updateValueByDOMTags(){this.value.length=0,[].forEach.call(this.getTagElms(),t=>{t.classList.contains(this.settings.classNames.tagNotAllowed.split(" ")[0])||this.value.push(this.tagData(t))}),this.update()},setRangeAtStartEnd(e,i){e="number"==typeof e?e:!!e,i=(i=i||this.DOM.input).lastChild||i;var s=document.getSelection();try{1<=s.rangeCount&&["Start","End"].forEach(t=>s.getRangeAt(0)["set"+t](i,e||i.length))}catch(e){console.warn("Tagify: ",e)}},injectAtCaret(t,e){if(e=e||this.state.selection.range)return"string"==typeof t&&(t=document.createTextNode(t)),e.deleteContents(),e.insertNode(t),this.setRangeAtStartEnd(!1,t),this.updateValueByDOMTags(),this.update(),this},input:{set(t="",e=!0){var i=this.settings.dropdown.closeOnSelect;this.state.inputText=t,e&&(this.DOM.input.innerHTML=s(""+t)),!t&&i&&this.dropdown.hide.bind(this),this.input.autocomplete.suggest.call(this),this.input.validate.call(this)},validate(){var t=!this.state.inputText||!0===this.validateTag({value:this.state.inputText});return this.DOM.input.classList.toggle(this.settings.classNames.inputInvalid,!t),t},normalize(t){var e=t||this.DOM.input,i=[];e.childNodes.forEach(t=>3==t.nodeType&&i.push(t.nodeValue)),i=i.join("\n");try{i=i.replace(/(?:\r\n|\r|\n)/g,this.settings.delimiters.source.charAt(0))}catch(t){}return i=i.replace(/\s/g," "),i=this.settings.trim?i.replace(/^\s+/,""):i},autocomplete:{suggest(t){var e,i,s;this.settings.autoComplete.enabled&&(i=(e=(t="string"==typeof(t=t||{})?{value:t}:t).value?""+t.value:"").substr(0,this.state.inputText.length).toLowerCase(),s=e.substring(this.state.inputText.length),e&&this.state.inputText&&i==this.state.inputText.toLowerCase()?(this.DOM.input.setAttribute("data-suggest",s),this.state.inputSuggestion=t):(this.DOM.input.removeAttribute("data-suggest"),delete this.state.inputSuggestion))},set(t){var e=this.DOM.input.getAttribute("data-suggest"),e=t||(e?this.state.inputText+e:null);return!!e&&("mix"==this.settings.mode?this.replaceTextWithNode(document.createTextNode(this.state.tag.prefix+e)):(this.input.set.call(this,e),this.setRangeAtStartEnd()),this.input.autocomplete.suggest.call(this),this.dropdown.hide.call(this),!0)}}},getTagIdx(e){return this.value.findIndex(t=>t.__tagId==(e||{}).__tagId)},getNodeIndex(t){var e=0;if(t)for(;t=t.previousElementSibling;)e++;return e},getTagElms(...t){t="."+[...this.settings.classNames.tag.split(" "),...t].join(".");return[].slice.call(this.DOM.scope.querySelectorAll(t))},getLastTag(){var t=this.DOM.scope.querySelectorAll(`${this.settings.classNames.tagSelector}:not(.${this.settings.classNames.tagHide}):not([readonly])`);return t[t.length-1]},tagData:(t,e,i)=>t?(e&&(t.__tagifyTagData=i?e:u({},t.__tagifyTagData||{},e)),t.__tagifyTagData):(console.warn("tag elment doesn't exist",t,e),e),isTagDuplicate(i,s){var a=this.settings;return"select"!=a.mode&&this.value.reduce((t,e)=>o(this.trim(""+i),e.value,s||a.dropdown.caseSensitive)?t+1:t,0)},getTagIndexByValue(i){var s=[];return this.getTagElms().forEach((t,e)=>{o(this.trim(t.textContent),i,this.settings.dropdown.caseSensitive)&&s.push(e)}),s},getTagElmByValue(t){t=this.getTagIndexByValue(t)[0];return this.getTagElms()[t]},flashTag(t){t&&(t.classList.add(this.settings.classNames.tagFlash),setTimeout(()=>{t.classList.remove(this.settings.classNames.tagFlash)},100))},isTagBlacklisted(e){return e=this.trim(e.toLowerCase()),this.settings.blacklist.filter(t=>(""+t).toLowerCase()==e).length},isTagWhitelisted(t){return!!this.getWhitelistItem(t)},getWhitelistItem(i,s,t){s=s||"value";var a,n=this.settings;return(t=t||n.whitelist).some(t=>{var e="string"==typeof t?t:t[s]||t.value;if(o(e,i,n.dropdown.caseSensitive,n.trim))return a="string"==typeof t?{value:t}:t,!0}),a=!a&&"value"==s&&"value"!=n.tagTextProp?this.getWhitelistItem(i,n.tagTextProp,t):a},validateTag(t){var e=this.settings,i="value"in t?"value":e.tagTextProp,s=this.trim(t[i]+"");return(t[i]+"").trim()?e.pattern&&e.pattern instanceof RegExp&&!e.pattern.test(s)?this.TEXTS.pattern:!e.duplicates&&this.isTagDuplicate(s,this.state.editing)?this.TEXTS.duplicate:this.isTagBlacklisted(s)||e.enforceWhitelist&&!this.isTagWhitelisted(s)?this.TEXTS.notAllowed:!e.validate||e.validate(t):this.TEXTS.empty},getInvalidTagAttrs(t,e){return{"aria-invalid":!0,class:`${t.class||""} ${this.settings.classNames.tagNotAllowed}`.trim(),title:e}},hasMaxTags(){return this.value.length>=this.settings.maxTags&&this.TEXTS.exceed},setReadonly(t){var e=this.settings;document.activeElement.blur(),e.readonly=t,this.DOM.scope[(t?"set":"remove")+"Attribute"]("readonly",!0),"mix"==e.mode&&(this.DOM.input.contentEditable=!t)},normalizeTags(t){var e=this.settings,i=e.whitelist,s=e.delimiters,a=e.mode,n=e.tagTextProp;e.enforceWhitelist;var o=[],e=!!i&&i[0]instanceof Object,i=t instanceof Array,r=t=>(t+"").split(s).filter(t=>t).map(t=>({[n]:this.trim(t),value:this.trim(t)}));if("string"==typeof(t="number"==typeof t?t.toString():t)){if(!t.trim())return[];t=r(t)}else i&&(t=[].concat(...t.map(t=>t.value?t:r(t))));return e&&(t.forEach(t=>{var e=o.map(t=>t.value),i=this.dropdown.filterListItems.call(this,t[n],{exact:!0}).filter(t=>!e.includes(t.value)),i=1<i.length?this.getWhitelistItem(t[n],n,i):i[0];i&&i instanceof Object?o.push(i):"mix"!=a&&(null==t.value&&(t.value=t[n]),o.push(t))}),t=o),t},parseMixTags(t){var e=this.settings,o=e.mixTagsInterpolator,r=e.duplicates,l=e.transformTag,d=e.enforceWhitelist,h=e.maxTags,g=e.tagTextProp,c=[];return t=t.split(o[0]).map((t,e)=>{var i,s=t.split(o[1]),a=s[0],n=c.length==h;try{if(a==+a)throw Error;i=JSON.parse(a)}catch(t){i=this.normalizeTags(a)[0]||{value:a}}if(n||!(1<s.length)||d&&!this.isTagWhitelisted(i.value)||!r&&this.isTagDuplicate(i.value)){if(t)return e?o[0]+t:t}else l.call(this,i),i[e=i[g]?g:"value"]=this.trim(i[e]),e=this.createTagElem(i),c.push(i),e.classList.add(this.settings.classNames.tagNoAnimation),s[0]=e.outerHTML,this.value.push(i);return s.join("")}).join(""),this.DOM.input.innerHTML=t,this.DOM.input.appendChild(document.createTextNode("")),this.DOM.input.normalize(),this.getTagElms().forEach((t,e)=>this.tagData(t,c[e])),this.update({withoutChangeEvent:!0}),t},replaceTextWithNode(t,e){if(this.state.tag||e){e=e||this.state.tag.prefix+this.state.tag.value;var i=window.getSelection(),s=i.anchorNode,a=this.state.tag.delimiters?this.state.tag.delimiters.length:0;return s.splitText(i.anchorOffset-a),e=s.nodeValue.lastIndexOf(e),e=s.splitText(e),t&&s.parentNode.replaceChild(t,e),!0}},selectTag(t,e){if(!this.settings.enforceWhitelist||this.isTagWhitelisted(e.value))return this.input.set.call(this,e[this.settings.tagTextProp||"value"],!0),this.state.actions.selectOption&&setTimeout(this.setRangeAtStartEnd.bind(this)),this.getLastTag()?this.replaceTag(this.getLastTag(),e):this.appendTag(t),this.value[0]=e,this.trigger("add",{tag:t,data:e}),this.update(),[t]},addEmptyTag(t){var e=u({value:""},t||{}),t=this.createTagElem(e);this.tagData(t,e),this.appendTag(t),this.editTag(t,{skipValidation:!0})},addTags(t,e,a=this.settings.skipInvalid){var n=[],o=this.settings,r=document.createDocumentFragment();return t&&0!=t.length?(t=this.normalizeTags(t),"mix"==o.mode?this.addMixTags(t):("select"==o.mode&&(e=!1),this.DOM.input.removeAttribute("style"),t.forEach(t=>{var e,i={},s=Object.assign({},t,{value:t.value+""});if((t=Object.assign({},s)).__isValid=this.hasMaxTags()||this.validateTag(t),o.transformTag.call(this,t),!0!==t.__isValid){if(a)return;u(i,this.getInvalidTagAttrs(t,t.__isValid),{__preInvalidData:s}),t.__isValid==this.TEXTS.duplicate&&this.flashTag(this.getTagElmByValue(t.value))}if(t.readonly&&(i["aria-readonly"]=!0),e=this.createTagElem(t,i),n.push(e),"select"==o.mode)return this.selectTag(e,t);r.appendChild(e),t.__isValid&&!0===t.__isValid?(this.value.push(t),this.update(),this.trigger("add",{tag:e,index:this.value.length-1,data:t})):(this.trigger("invalid",{data:t,index:this.value.length,tag:e,message:t.__isValid}),o.keepInvalidTags||setTimeout(()=>this.removeTags(e,!0),1e3)),this.dropdown.position.call(this)}),this.appendTag(r),t.length&&e&&this.input.set.call(this),this.dropdown.refilter.call(this),n)):("select"==o.mode&&this.removeAllTags(),n)},addMixTags(t){var e,i;t[0].prefix||this.state.tag?this.prefixedTextToTag(t[0]):("string"==typeof t&&(t=[{value:t}]),e=!!this.state.selection,i=document.createDocumentFragment(),t.forEach(t=>{t=this.createTagElem(t);i.appendChild(t),this.insertAfterTag(t)}),e?this.injectAtCaret(i):(this.DOM.input.focus(),(e=this.setStateSelection()).range.setStart(this.DOM.input,e.range.endOffset),e.range.setEnd(this.DOM.input,e.range.endOffset),this.DOM.input.appendChild(i),this.updateValueByDOMTags(),this.update()))},prefixedTextToTag(t){var e,i=this.settings,s=this.state.tag.delimiters;return i.transformTag.call(this,t),t.prefix=t.prefix||this.state.tag?this.state.tag.prefix:(i.pattern.source||i.pattern)[0],e=this.createTagElem(t),this.replaceTextWithNode(e)||this.DOM.input.appendChild(e),setTimeout(()=>e.classList.add(this.settings.classNames.tagNoAnimation),300),this.value.push(t),this.update(),s||(s=this.insertAfterTag(e)||e,this.placeCaretAfterNode(s)),this.state.tag=null,this.trigger("add",u({},{tag:e},{data:t})),e},appendTag(t){var e=this.DOM,i=e.scope.lastElementChild;i===e.input?e.scope.insertBefore(t,i):e.scope.appendChild(t)},createTagElem(t,e){t.__tagId=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16));var e=u({},t,function(s){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach(function(t){var e,i;e=s,t=a[i=t],i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(a,t))})}return s}({value:s(t.value+"")},e));return function(t){for(var e,i=document.createNodeIterator(t,NodeFilter.SHOW_TEXT,null,!1);e=i.nextNode();)e.textContent.trim()||e.parentNode.removeChild(e)}(e=this.parseTemplate("tag",[e])),this.tagData(e,t),e},reCheckInvalidTags(){var t=this.settings,t=`${t.classNames.tagSelector}${t.classNames.tagNotAllowedSelector}`,t=this.DOM.scope.querySelectorAll(t);[].forEach.call(t,t=>{var e=this.tagData(t),i=t.getAttribute("title")==this.TEXTS.duplicate,s=!0===this.validateTag(e);i&&s&&(e=e.__preInvalidData||{value:e.value},this.replaceTag(t,e))})},removeTags(t,i,s){var a;t=t&&t instanceof HTMLElement?[t]:t instanceof Array?t:t?[t]:[this.getLastTag()],a=t.reduce((t,e)=>((e=e&&"string"==typeof e?this.getTagElmByValue(e):e)&&t.push({node:e,idx:this.getTagIdx(this.tagData(e)),data:this.tagData(e,{__removed:!0})}),t),[]),s="number"==typeof s?s:this.CSSVars.tagHideTransition,"select"==this.settings.mode&&(s=0,this.input.set.call(this)),1==a.length&&a[0].node.classList.contains(this.settings.classNames.tagNotAllowed)&&(i=!0),a.length&&this.settings.hooks.beforeRemoveTag(a,{tagify:this}).then(()=>{function e(t){t.node.parentNode&&(t.node.parentNode.removeChild(t.node),i?this.settings.keepInvalidTags&&this.trigger("remove",{tag:t.node,index:t.idx}):(this.trigger("remove",{tag:t.node,index:t.idx,data:t.data}),this.dropdown.refilter.call(this),this.dropdown.position.call(this),this.DOM.input.normalize(),this.settings.keepInvalidTags&&this.reCheckInvalidTags()))}s&&10<s&&1==a.length?function(t){t.node.style.width=parseFloat(window.getComputedStyle(t.node).width)+"px",document.body.clientTop,t.node.classList.add(this.settings.classNames.tagHide),setTimeout(e.bind(this),s,t)}.call(this,a[0]):a.forEach(e.bind(this)),i||(a.forEach(t=>{t=Object.assign({},t.data);delete t.__removed;t=this.getTagIdx(t);-1<t&&this.value.splice(t,1)}),this.update())}).catch(t=>{})},removeTagsFromDOM(){[].slice.call(this.getTagElms()).forEach(t=>t.parentNode.removeChild(t))},removeAllTags(t){t=t||{},this.value=[],"mix"==this.settings.mode?this.DOM.input.innerHTML="":this.removeTagsFromDOM(),this.dropdown.position.call(this),"select"==this.settings.mode&&this.input.set.call(this),this.update(t)},postUpdate(){var t=this.settings.classNames,e="mix"==this.settings.mode?this.settings.mixMode.integrated?this.DOM.input.textContent:this.DOM.originalInput.value:this.value.length;this.toggleClass(t.hasMaxTags,this.value.length>=this.settings.maxTags),this.toggleClass(t.hasNoTags,!this.value.length),this.toggleClass(t.empty,!e)},update(t){var e=this.DOM.originalInput,t=(t||{}).withoutChangeEvent;this.settings.mixMode.integrated||(e.value=this.getInputValue()),this.postUpdate(),!t&&this.state.loadedOriginalValues&&this.triggerChangeEvent()},getInputValue(){var t=this.getCleanValue();return"mix"==this.settings.mode?this.getMixedTagsAsString(t):t.length?this.settings.originalInputValueFormat?this.settings.originalInputValueFormat(t):JSON.stringify(t):""},getCleanValue(t){return t=t||this.value,e=this.dataProps,t&&a(t)&&t.map(t=>n(t,e));var e},getMixedTagsAsString(){var i="",s=this,a=this.settings.mixTagsInterpolator;return function e(t){t.childNodes.forEach(t=>{if(1==t.nodeType){if(t.classList.contains(s.settings.classNames.tag)&&s.tagData(t))return s.tagData(t).__removed?void 0:void(i+=a[0]+JSON.stringify(n(s.tagData(t),s.dataProps))+a[1]);"BR"!=t.tagName||t.parentNode!=s.DOM.input&&1!=t.parentNode.childNodes.length?"DIV"!=t.tagName&&"P"!=t.tagName||(i+="\r\n",e(t)):i+="\r\n"}else i+=t.textContent})}(this.DOM.input),i}}).removeTag=l.prototype.removeTags,l},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Tagify=e()}(jQuery);